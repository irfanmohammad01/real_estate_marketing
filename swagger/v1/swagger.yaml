---
openapi: 3.0.1
info:
  title: Real Estate Marketing API
  version: v1
  description: API for managing real estate organizations, users, and email marketing
    templates. Supports multi-tenant architecture with organization-based access control.
servers:
- url: http://localhost:3000
  description: Development server
- url: https://{defaultHost}
  variables:
    defaultHost:
      default: api.example.com
  description: Production server
paths:
  "/auth/super/login":
    post:
      summary: Super User Login
      tags:
      - Authentication
      description: Authenticate as a super user and receive a JWT token
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                  example: super@admin.com
                password:
                  type: string
                  example: SecureP@ss123
              required:
              - email
              - password
      responses:
        '200':
          description: successful login
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: JWT Bearer token
                  super_user:
                    type: object
                    properties:
                      id:
                        type: integer
                      email:
                        type: string
        '401':
          description: invalid credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Invalid email or password
  "/auth/login":
    post:
      summary: User Login
      tags:
      - Authentication
      description: Authenticate as a regular user and receive a JWT token
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                  example: user@organization.com
                password:
                  type: string
                  example: SecureP@ss123
              required:
              - email
              - password
      responses:
        '200':
          description: successful login
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: JWT Bearer token
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                      email:
                        type: string
                      full_name:
                        type: string
                      role:
                        type: string
        '401':
          description: invalid credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Invalid email or password
  "/organizations":
    get:
      summary: List all organizations
      tags:
      - Organizations
      description: Retrieve a list of all organizations (Super User only)
      security:
      - Bearer: []
      responses:
        '200':
          description: success
          content:
            application/json:
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/Organization"
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
    post:
      summary: Create organization with first user
      tags:
      - Organizations
      description: Create a new organization and its first admin user in one atomic
        operation (Super User only)
      security:
      - Bearer: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                organization:
                  type: object
                  properties:
                    name:
                      type: string
                      example: Acme Real Estate
                    description:
                      type: string
                      example: Leading real estate company
                  required:
                  - name
                user:
                  type: object
                  properties:
                    full_name:
                      type: string
                      example: John Doe
                    email:
                      type: string
                      format: email
                      example: admin@acme.com
                    phone:
                      type: string
                      example: "+1234567890"
                  required:
                  - full_name
                  - email
              required:
              - organization
              - user
      responses:
        '201':
          description: created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  organization:
                    "$ref": "#/components/schemas/Organization"
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                      full_name:
                        type: string
                      email:
                        type: string
                      phone:
                        type: string
                      status:
                        type: string
                      role:
                        type: string
        '400':
          description: bad request - missing parameters
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '422':
          description: validation failed
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
  "/organizations/{id}":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
      description: Organization ID
    get:
      summary: Show organization
      tags:
      - Organizations
      description: Retrieve details of a specific organization (Super User only)
      security:
      - Bearer: []
      responses:
        '200':
          description: success
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Organization"
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '404':
          description: not found
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
    patch:
      summary: Update organization
      tags:
      - Organizations
      description: Update organization details (Super User only)
      security:
      - Bearer: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                organization:
                  type: object
                  properties:
                    name:
                      type: string
                    description:
                      type: string
      responses:
        '200':
          description: success
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Organization"
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '422':
          description: validation failed
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
    delete:
      summary: Soft delete organization
      tags:
      - Organizations
      description: Soft delete an organization (Super User only)
      security:
      - Bearer: []
      responses:
        '200':
          description: success
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
  "/organizations/{id}/restore":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
      description: Organization ID
    post:
      summary: Restore deleted organization
      tags:
      - Organizations
      description: Restore a soft-deleted organization (Super User only)
      security:
      - Bearer: []
      responses:
        '200':
          description: success
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '404':
          description: not found
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
  "/users":
    get:
      summary: List users in organization
      tags:
      - Users
      description: Retrieve all users in the current organization (Org Admin only)
      security:
      - Bearer: []
      responses:
        '200':
          description: success
          content:
            application/json:
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/User"
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
    post:
      summary: Create new user
      tags:
      - Users
      description: Create a new user in the organization (Org Admin only). Password is auto-generated and sent via email.
      security:
      - Bearer: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                full_name:
                  type: string
                  example: Jane Smith
                email:
                  type: string
                  format: email
                  example: jane@organization.com
                phone:
                  type: string
                  example: "+1234567890"
              required:
              - full_name
              - email
      responses:
        '201':
          description: created
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/User"
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '422':
          description: validation failed
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
  "/users/{id}":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
      description: User ID
    get:
      summary: Show user details
      tags:
      - Users
      description: Retrieve details of a specific user in the organization (Org Admin
        only)
      security:
      - Bearer: []
      responses:
        '200':
          description: success
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/User"
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '404':
          description: not found
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
    patch:
      summary: Update user
      tags:
      - Users
      description: Update user details (Org Admin only)
      security:
      - Bearer: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                full_name:
                  type: string
                phone:
                  type: string
      responses:
        '200':
          description: success
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/User"
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '422':
          description: validation failed
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
  "/admin/org_admins":
    post:
      summary: Create organization admin
      tags:
      - Admin
      description: Create a new organization admin user (Super User only)
      security:
      - Bearer: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    organization_id:
                      type: integer
                      example: 1
                    full_name:
                      type: string
                      example: Admin User
                    email:
                      type: string
                      format: email
                      example: admin@organization.com
                    password:
                      type: string
                      example: SecureP@ss123
                    phone:
                      type: string
                      example: "+1234567890"
                  required:
                  - organization_id
                  - full_name
                  - email
                  - password
      responses:
        '201':
          description: created
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/User"
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '422':
          description: validation failed
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
    patch:
      summary: Update organization admin
      tags:
      - Admin
      description: Update organization admin details (Super User only)
      security:
      - Bearer: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: integer
                  description: User ID to update
                user:
                  type: object
                  properties:
                    full_name:
                      type: string
                    phone:
                      type: string
      responses:
        '200':
          description: success
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/User"
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '422':
          description: validation failed
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
  "/email_types":
    get:
      summary: List all email types
      tags:
      - Email Types
      description: Retrieve all email types (Org Admin only)
      security:
      - Bearer: []
      responses:
        '200':
          description: success
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    key:
                      type: string
                    description:
                      type: string
                    created_at:
                      type: string
                      format: datetime
                    updated_at:
                      type: string
                      format: datetime
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
    post:
      summary: Create email type
      tags:
      - Email Types
      description: Create a new email type (Org Admin only)
      security:
      - Bearer: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email_type:
                  type: object
                  properties:
                    key:
                      type: string
                      example: welcome_email
                    description:
                      type: string
                      example: Welcome email for new users
                  required:
                  - key
      responses:
        '201':
          description: created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  key:
                    type: string
                  description:
                    type: string
                  created_at:
                    type: string
                    format: datetime
                  updated_at:
                    type: string
                    format: datetime
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '422':
          description: validation failed
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
  "/email_templates":
    get:
      summary: List email templates
      tags:
      - Email Templates
      description: Retrieve all email templates in the organization (Org Admin or
        Org User)
      security:
      - Bearer: []
      responses:
        '200':
          description: success
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    email_type_id:
                      type: integer
                    organization_id:
                      type: integer
                    name:
                      type: string
                    subject:
                      type: string
                    preheader:
                      type: string
                    from_name:
                      type: string
                    from_email:
                      type: string
                    reply_to:
                      type: string
                    html_body:
                      type: string
                    text_body:
                      type: string
                    created_at:
                      type: string
                      format: datetime
                    updated_at:
                      type: string
                      format: datetime
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
    post:
      summary: Create email template
      tags:
      - Email Templates
      description: Create a new email template (Org Admin or Org User)
      security:
      - Bearer: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email_template:
                  type: object
                  properties:
                    email_type_id:
                      type: integer
                      example: 1
                    name:
                      type: string
                      example: Welcome Email Template
                    subject:
                      type: string
                      example: Welcome to our platform!
                    preheader:
                      type: string
                      example: Get started with your account
                    from_name:
                      type: string
                      example: Support Team
                    from_email:
                      type: string
                      example: support@company.com
                    reply_to:
                      type: string
                      example: noreply@company.com
                    html_body:
                      type: string
                      example: "<h1>Welcome!</h1><p>Thanks for joining us.</p>"
                    text_body:
                      type: string
                      example: Welcome! Thanks for joining us.
                  required:
                  - email_type_id
                  - name
                  - subject
      responses:
        '201':
          description: created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '422':
          description: validation failed
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
  "/email_templates/{id}":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
      description: Template ID
    get:
      summary: Show email template
      tags:
      - Email Templates
      description: Retrieve details of a specific email template (Org Admin or Org
        User)
      security:
      - Bearer: []
      responses:
        '200':
          description: success
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  email_type_id:
                    type: integer
                  organization_id:
                    type: integer
                  name:
                    type: string
                  subject:
                    type: string
                  preheader:
                    type: string
                  from_name:
                    type: string
                  from_email:
                    type: string
                  reply_to:
                    type: string
                  html_body:
                    type: string
                  text_body:
                    type: string
                  created_at:
                    type: string
                    format: datetime
                  updated_at:
                    type: string
                    format: datetime
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '404':
          description: not found
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
    patch:
      summary: Update email template
      tags:
      - Email Templates
      description: Update email template details (Org Admin or Org User)
      security:
      - Bearer: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email_template:
                  type: object
                  properties:
                    name:
                      type: string
                    subject:
                      type: string
                    preheader:
                      type: string
                    from_name:
                      type: string
                    from_email:
                      type: string
                    reply_to:
                      type: string
                    html_body:
                      type: string
                    text_body:
                      type: string
      responses:
        '200':
          description: success
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '422':
          description: validation failed
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
  "/email_templates/by_type":
    get:
      summary: Get templates by type
      tags:
      - Email Templates
      description: Retrieve email templates filtered by type key (Org Admin or Org
        User)
      security:
      - Bearer: []
      parameters:
      - name: key
        in: query
        required: true
        schema:
          type: string
        description: Email type key
        example: welcome_email
      responses:
        '200':
          description: success
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    email_type_id:
                      type: integer
                    organization_id:
                      type: integer
                    name:
                      type: string
                    subject:
                      type: string
                    created_at:
                      type: string
                      format: datetime
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
        '403':
          description: forbidden
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ErrorResponse"
components:
  securitySchemes:
    Bearer:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Bearer token authentication. Use super user token for admin
        endpoints, regular user token for organization-specific endpoints.
  schemas:
    ErrorResponse:
      type: object
      properties:
        errors:
          type: object
          description: Error messages organized by field or category
    Organization:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        created_at:
          type: string
          format: datetime
        updated_at:
          type: string
          format: datetime
        deleted_at:
          type: string
          format: datetime
          nullable: true
    User:
      type: object
      properties:
        id:
          type: integer
        full_name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
        status:
          type: string
        organization_id:
          type: integer
        role_id:
          type: integer
